<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Endpoints - E.I.O</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0e27;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 30px;
            background: linear-gradient(135deg, #2196F3, #00BCD4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .test-card h3 {
            margin-bottom: 15px;
            color: #2196F3;
        }

        .test-btn {
            background: linear-gradient(135deg, #2196F3, #00BCD4);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .test-btn:hover {
            transform: scale(1.05);
        }

        .test-btn:active {
            transform: scale(0.95);
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .success {
            border-left: 3px solid #4CAF50;
        }

        .error {
            border-left: 3px solid #F44336;
        }

        .loading {
            border-left: 3px solid #FF9800;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }

        .status-offline {
            background: #F44336;
        }

        .server-status {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ Teste de Endpoints da API E.I.O</h1>

        <div class="server-status">
            <div>
                <span class="status-indicator status-offline" id="statusDot"></span>
                <strong id="statusText">Servidor Offline</strong>
            </div>
            <button class="test-btn" onclick="checkHealth()">Verificar Servidor</button>
        </div>

        <div class="test-grid">
            <!-- Analytics Tests -->
            <div class="test-card">
                <h3>üìä API de An√°lise (Analytics)</h3>
                <button class="test-btn" onclick="testAnalyticsOverview()">Testar Vis√£o Geral</button>
                <button class="test-btn" onclick="testBestPosts()">Testar Melhores Posts</button>
                <button class="test-btn" onclick="testBestTimes()">Testar Melhores Hor√°rios</button>
                <div id="analytics-result" class="result" style="display:none;"></div>
            </div>

            <!-- Calendar Tests -->
            <div class="test-card">
                <h3>üìÖ API de Calend√°rio</h3>
                <button class="test-btn" onclick="testGetCalendar()">Obter Calend√°rio</button>
                <button class="test-btn" onclick="testCreateContent()">Criar Conte√∫do</button>
                <button class="test-btn" onclick="testExportCalendar()">Exportar Calend√°rio</button>
                <div id="calendar-result" class="result" style="display:none;"></div>
            </div>

            <!-- CRM Tests -->
            <div class="test-card">
                <h3>üë• API de CRM</h3>
                <button class="test-btn" onclick="testGetLeads()">Obter Leads</button>
                <button class="test-btn" onclick="testCreateLead()">Criar Lead</button>
                <button class="test-btn" onclick="testCRMStats()">Obter Estat√≠sticas</button>
                <div id="crm-result" class="result" style="display:none;"></div>
            </div>

            <!-- Auth Tests -->
            <div class="test-card">
                <h3>üîê API de Autentica√ß√£o</h3>
                <button class="test-btn" onclick="testRegister()">Testar Registro</button>
                <button class="test-btn" onclick="testLogin()">Testar Login</button>
                <button class="test-btn" onclick="testProfile()">Obter Perfil</button>
                <div id="auth-result" class="result" style="display:none;"></div>
            </div>

            <!-- Flow Tests -->
            <div class="test-card">
                <h3>‚ö° API de Fluxos (Flows)</h3>
                <button class="test-btn" onclick="testGetFlows()">Obter Fluxos</button>
                <button class="test-btn" onclick="testCreateFlow()">Criar Fluxo</button>
                <button class="test-btn" onclick="testStartFlow()">Iniciar Fluxo</button>
                <div id="flow-result" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script>
        const API_URL = 'http://localhost:3000';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (isError ? 'error' : 'success');
            element.textContent = JSON.stringify(data, null, 2);
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result loading';
            element.textContent = 'Carregando...';
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();

                document.getElementById('statusDot').className = 'status-indicator status-online';
                document.getElementById('statusText').textContent = `Servidor Online - Uptime: ${Math.floor(data.uptime)}s`;

                console.log('Health check:', data);
                return true;
            } catch (error) {
                document.getElementById('statusDot').className = 'status-indicator status-offline';
                document.getElementById('statusText').textContent = 'Servidor Offline';
                console.error('Health check failed:', error);
                return false;
            }
        }

        // Analytics Tests
        async function testAnalyticsOverview() {
            showLoading('analytics-result');
            try {
                const data = await api.getAnalyticsOverview(30);
                showResult('analytics-result', data);
            } catch (error) {
                showResult('analytics-result', { error: error.message }, true);
            }
        }

        async function testBestPosts() {
            showLoading('analytics-result');
            try {
                const data = await api.getBestPosts(30);
                showResult('analytics-result', data);
            } catch (error) {
                showResult('analytics-result', { error: error.message }, true);
            }
        }

        async function testBestTimes() {
            showLoading('analytics-result');
            try {
                const data = await api.getBestTimes(30);
                showResult('analytics-result', data);
            } catch (error) {
                showResult('analytics-result', { error: error.message }, true);
            }
        }

        // Calendar Tests
        async function testGetCalendar() {
            showLoading('calendar-result');
            try {
                const data = await api.getScheduledContent();
                showResult('calendar-result', data);
            } catch (error) {
                showResult('calendar-result', { error: error.message }, true);
            }
        }

        async function testCreateContent() {
            showLoading('calendar-result');
            try {
                const data = await api.createScheduledContent({
                    type: 'post',
                    scheduled_date: '2025-01-15T12:00:00',
                    caption: 'Test post from API',
                    hashtags: '#test #api',
                    status: 'scheduled'
                });
                showResult('calendar-result', data);
            } catch (error) {
                showResult('calendar-result', { error: error.message }, true);
            }
        }

        async function testExportCalendar() {
            showLoading('calendar-result');
            try {
                const data = await api.exportCalendar(1, 2025);
                showResult('calendar-result', data);
            } catch (error) {
                showResult('calendar-result', { error: error.message }, true);
            }
        }

        // CRM Tests
        async function testGetLeads() {
            showLoading('crm-result');
            try {
                const data = await api.getLeads();
                showResult('crm-result', data);
            } catch (error) {
                showResult('crm-result', { error: error.message }, true);
            }
        }

        async function testCreateLead() {
            showLoading('crm-result');
            try {
                const data = await api.createLead({
                    name: 'Test Lead',
                    username: '@testlead',
                    tags: ['test', 'api'],
                    notes: 'Created from API test',
                    status: 'new'
                });
                showResult('crm-result', data);
            } catch (error) {
                showResult('crm-result', { error: error.message }, true);
            }
        }

        async function testCRMStats() {
            showLoading('crm-result');
            try {
                const data = await api.getCRMStats();
                showResult('crm-result', data);
            } catch (error) {
                showResult('crm-result', { error: error.message }, true);
            }
        }

        // Auth Tests
        async function testRegister() {
            showLoading('auth-result');
            try {
                const randomEmail = `test${Date.now()}@example.com`;
                const data = await api.register(randomEmail, 'Test@123', 'Test User');
                showResult('auth-result', data);
            } catch (error) {
                showResult('auth-result', { error: error.message }, true);
            }
        }

        async function testLogin() {
            showLoading('auth-result');
            try {
                // First register a user
                const randomEmail = `test${Date.now()}@example.com`;
                await api.register(randomEmail, 'Test@123', 'Test User');

                // Then login
                const data = await api.login(randomEmail, 'Test@123');
                showResult('auth-result', data);
            } catch (error) {
                showResult('auth-result', { error: error.message }, true);
            }
        }

        async function testProfile() {
            showLoading('auth-result');
            try {
                const data = await api.getProfile();
                showResult('auth-result', data);
            } catch (error) {
                showResult('auth-result', { error: error.message }, true);
            }
        }

        // Flow Tests
        async function testGetFlows() {
            showLoading('flow-result');
            try {
                const data = await api.getFlows();
                showResult('flow-result', data);
            } catch (error) {
                showResult('flow-result', { error: error.message }, true);
            }
        }

        async function testCreateFlow() {
            showLoading('flow-result');
            try {
                const data = await api.createFlow({
                    name: 'Test Flow',
                    description: 'Flow created from API test',
                    config: {
                        actions: ['follow', 'like']
                    }
                });
                showResult('flow-result', data);
            } catch (error) {
                showResult('flow-result', { error: error.message }, true);
            }
        }

        async function testStartFlow() {
            showLoading('flow-result');
            try {
                // First create a flow
                const flow = await api.createFlow({
                    name: 'Test Flow to Start',
                    config: { actions: ['follow'] }
                });

                // Then start it
                const data = await api.startFlow(flow.data.flow.id);
                showResult('flow-result', data);
            } catch (error) {
                showResult('flow-result', { error: error.message }, true);
            }
        }

        // Check server on load
        window.addEventListener('load', () => {
            checkHealth();
            setInterval(checkHealth, 10000); // Check every 10 seconds
        });
    </script>
</body>

</html>